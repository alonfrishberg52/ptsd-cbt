{% extends 'dashboard/base_enhanced.html' %}

{% block title %}דשבורד ראשי - NarraTIVE{% endblock %}
{% block page_title %}דשבורד ראשי{% endblock %}
{% block page_description %}סקירה כללית של המערכת והטיפולים הפעילים{% endblock %}

{% block content %}
<!-- Enhanced Main Dashboard Content -->

<!-- Live Statistics Cards -->
<div class="live-stats-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-lg); margin-bottom: var(--space-2xl);">
    <!-- Real-time Patient Count -->
    <div class="stat-card-enhanced" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%); color: white; padding: var(--space-xl); border-radius: var(--radius-2xl); box-shadow: var(--shadow-xl); position: relative; overflow: hidden;">
        <div style="position: absolute; top: -50px; right: -50px; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;"></div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">סה״כ מטופלים פעילים</div>
                <div style="font-size: 2.5rem; font-weight: 800; margin-top: var(--space-xs);" id="livePatientCount">{{ total_patients or 0 }}</div>
            </div>
            <div style="width: 60px; height: 60px; background: rgba(255, 255, 255, 0.2); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
                <i class="bi bi-people" style="font-size: 1.8rem;"></i>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: var(--space-sm);">
            <span class="badge" style="background: rgba(255, 255, 255, 0.2); color: white;">+3 השבוע</span>
            <span style="font-size: 0.85rem; opacity: 0.8;">גידול של 12% מהחודש הקודם</span>
        </div>
    </div>

    <!-- Session Quality Score -->
    <div class="stat-card-enhanced" style="background: linear-gradient(135deg, var(--success-color) 0%, #16a34a 100%); color: white; padding: var(--space-xl); border-radius: var(--radius-2xl); box-shadow: var(--shadow-xl); position: relative; overflow: hidden;">
        <div style="position: absolute; top: -50px; right: -50px; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;"></div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">איכות מפגשים</div>
                <div style="font-size: 2.5rem; font-weight: 800; margin-top: var(--space-xs);" id="qualityScore">8.7</div>
            </div>
            <div style="width: 60px; height: 60px; background: rgba(255, 255, 255, 0.2); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
                <i class="bi bi-star-fill" style="font-size: 1.8rem;"></i>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: var(--space-sm);">
            <span class="badge" style="background: rgba(255, 255, 255, 0.2); color: white;">מעולה</span>
            <span style="font-size: 0.85rem; opacity: 0.8;">בהתבסס על 47 מפגשים</span>
        </div>
    </div>

    <!-- Today's Progress -->
    <div class="stat-card-enhanced" style="background: linear-gradient(135deg, var(--accent-color) 0%, #d97706 100%); color: white; padding: var(--space-xl); border-radius: var(--radius-2xl); box-shadow: var(--shadow-xl); position: relative; overflow: hidden;">
        <div style="position: absolute; top: -50px; right: -50px; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;"></div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">התקדמות היום</div>
                <div style="font-size: 2.5rem; font-weight: 800; margin-top: var(--space-xs);" id="todayProgress">6</div>
            </div>
            <div style="width: 60px; height: 60px; background: rgba(255, 255, 255, 0.2); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
                <i class="bi bi-graph-up-arrow" style="font-size: 1.8rem;"></i>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: var(--space-sm);">
            <span class="badge" style="background: rgba(255, 255, 255, 0.2); color: white;">מפגשים הושלמו</span>
            <span style="font-size: 0.85rem; opacity: 0.8;">2 נוספים מתוכננים</span>
        </div>
    </div>

    <!-- Emergency Alert -->
    <div class="stat-card-enhanced" style="background: linear-gradient(135deg, var(--warning-color) 0%, #dc2626 100%); color: white; padding: var(--space-xl); border-radius: var(--radius-2xl); box-shadow: var(--shadow-xl); position: relative; overflow: hidden; animation: subtlePulse 3s ease-in-out infinite;">
        <div style="position: absolute; top: -50px; right: -50px; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;"></div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">התראות דחופות</div>
                <div style="font-size: 2.5rem; font-weight: 800; margin-top: var(--space-xs);" id="emergencyAlerts">2</div>
            </div>
            <div style="width: 60px; height: 60px; background: rgba(255, 255, 255, 0.2); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
                <i class="bi bi-exclamation-triangle-fill" style="font-size: 1.8rem;"></i>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: var(--space-sm);">
            <button class="btn" onclick="viewEmergencies()" style="background: rgba(255, 255, 255, 0.2); color: white; border: none; font-size: 0.85rem; padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-md);">צפה בפרטים</button>
        </div>
    </div>
</div>

<!-- Enhanced Today's Sessions and Urgent Cases -->
<div class="metrics-row" style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-xl); margin-bottom: var(--space-2xl);">
    <!-- Today's Sessions - Enhanced -->
    <div class="card enhanced-card" style="background: var(--bg-glass); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: var(--radius-2xl); box-shadow: var(--shadow-xl);">
        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-xl) var(--space-xl) 0;">
            <div>
                <h3 style="margin: 0; font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: var(--space-md);">
                    <i class="bi bi-calendar-check" style="color: var(--primary-color); font-size: 1.8rem;"></i>
                    מפגשים היום
                </h3>
                <p style="color: var(--text-secondary); margin: var(--space-xs) 0 0;">8 מפגשים מתוכננים, 6 הושלמו</p>
            </div>
            <div style="display: flex; gap: var(--space-sm);">
                <button class="btn btn-ghost btn-sm" onclick="refreshSessions()" data-tooltip="רענן">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
                <button class="btn btn-primary btn-sm" onclick="addSession()" data-tooltip="הוסף מפגש">
                    <i class="bi bi-plus"></i>
                </button>
            </div>
        </div>
        <div class="card-body" style="padding: var(--space-xl);">
            <div id="todaysSessions">
                <!-- Sessions will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Quick Actions Panel -->
    <div class="card enhanced-card" style="background: var(--bg-glass); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: var(--radius-2xl); box-shadow: var(--shadow-xl);">
        <div class="card-header" style="padding: var(--space-xl) var(--space-xl) 0;">
            <h3 style="margin: 0; font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: var(--space-sm);">
                <i class="bi bi-lightning-charge" style="color: var(--accent-color);"></i>
                פעולות מהירות
            </h3>
        </div>
        <div class="card-body" style="padding: var(--space-xl); display: flex; flex-direction: column; gap: var(--space-md);">
            <button class="action-btn" onclick="quickAddPatient()" style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md); border: 1px solid rgba(37, 99, 235, 0.2); border-radius: var(--radius-lg); background: rgba(37, 99, 235, 0.05); transition: all var(--transition-fast); text-align: right; width: 100%;">
                <div style="width: 40px; height: 40px; background: var(--primary-color); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="bi bi-person-plus"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; margin-bottom: var(--space-xs);">הוסף מטופל חדש</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">יצירת פרופיל מטופל חדש</div>
                </div>
            </button>
            
            <button class="action-btn" onclick="generateStory()" style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: var(--radius-lg); background: rgba(34, 197, 94, 0.05); transition: all var(--transition-fast); text-align: right; width: 100%;">
                <div style="width: 40px; height: 40px; background: var(--success-color); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="bi bi-journal-plus"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; margin-bottom: var(--space-xs);">יצירת סיפור חשיפה</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">AI מונע לטיפול מותאם</div>
                </div>
            </button>
            
            <button class="action-btn" onclick="viewAnalytics()" style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: var(--radius-lg); background: rgba(245, 158, 11, 0.05); transition: all var(--transition-fast); text-align: right; width: 100%;">
                <div style="width: 40px; height: 40px; background: var(--accent-color); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="bi bi-graph-up"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; margin-bottom: var(--space-xs);">ניתוח נתונים</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">דשבורד אנליטיקה מתקדם</div>
                </div>
            </button>
            
            <button class="action-btn" onclick="viewNotifications()" style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: var(--radius-lg); background: rgba(239, 68, 68, 0.05); transition: all var(--transition-fast); text-align: right; width: 100%;">
                <div style="width: 40px; height: 40px; background: var(--warning-color); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="bi bi-bell"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; margin-bottom: var(--space-xs);">מרכז התראות</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">2 התראות חדשות</div>
                </div>
            </button>
        </div>
    </div>
</div>

<!-- Recent Patients & Quick Actions -->
<div class="content-row" style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-xl); margin-bottom: var(--space-2xl);">
    <!-- Recent Patients -->
    <div class="card">
        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; font-size: 1.25rem; font-weight: 700;">מטופלים אחרונים</h3>
            <a href="/dashboard/patients" class="btn btn-ghost btn-sm">
                <i class="bi bi-arrow-left"></i>
                צפה בכל המטופלים
            </a>
        </div>
        <div class="card-body" style="padding: 0;">
            <div class="patients-list" style="max-height: 400px; overflow-y: auto;">
                <div id="recentPatients">
                    <div class="empty-state" style="text-align: center; padding: var(--space-2xl); color: var(--text-muted);">
                        <i class="bi bi-people" style="font-size: 3rem; margin-bottom: var(--space-md);"></i>
                        <p>טוען רשימת מטופלים...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions & System Info -->
    <div style="display: flex; flex-direction: column; gap: var(--space-lg);">
        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h3 style="margin: 0; font-size: 1.25rem; font-weight: 700;">פעולות מהירות</h3>
            </div>
            <div class="card-body" style="display: flex; flex-direction: column; gap: var(--space-md);">
                <button class="btn btn-primary" data-modal="add-patient" style="width: 100%; justify-content: flex-start;">
                    <i class="bi bi-person-plus"></i>
                    הוסף מטופל חדש
                </button>
                
                <a href="/dashboard/patients" class="btn btn-outline" style="width: 100%; justify-content: flex-start; text-decoration: none;">
                    <i class="bi bi-list-ul"></i>
                    ניהול מטופלים
                </a>
                
                <a href="/dashboard/stories" class="btn btn-outline" style="width: 100%; justify-content: flex-start; text-decoration: none;">
                    <i class="bi bi-journal-text"></i>
                    סיפורי חשיפה
                </a>
                
                <a href="/dashboard/session-notes" class="btn btn-outline" style="width: 100%; justify-content: flex-start; text-decoration: none;">
                    <i class="bi bi-journal-medical"></i>
                    הערות מפגש
                </a>
            </div>
        </div>

        <!-- System Statistics -->
        <div class="card">
            <div class="card-header">
                <h3 style="margin: 0; font-size: 1.25rem; font-weight: 700;">סטטיסטיקות מערכת</h3>
            </div>
            <div class="card-body">
                <div class="stat-item" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm);">
                    <span style="color: var(--text-secondary);">סה״כ מטופלים:</span>
                    <span style="font-weight: 700; color: var(--primary-color);">{{ total_patients }}</span>
                </div>
                
                <div class="stat-item" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm);">
                    <span style="color: var(--text-secondary);">סיפורי חשיפה:</span>
                    <span style="font-weight: 700; color: var(--success-color);">{{ total_stories }}</span>
                </div>
                
                <div class="stat-item" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm);">
                    <span style="color: var(--text-secondary);">משוב אחרון:</span>
                    <span style="font-weight: 700; color: var(--accent-color);">{{ session_feedback|length }} ביקורות</span>
                </div>
                
                <hr style="margin: var(--space-md) 0; border: none; border-top: 1px solid rgba(0, 0, 0, 0.1);">
                
                <div class="stat-item" style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: var(--text-secondary);">סטטוס מערכת:</span>
                    <span style="color: var(--success-color); font-weight: 600;">
                        <i class="bi bi-circle-fill" style="font-size: 0.6rem; margin-left: 5px;"></i>
                        פעילה
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="activity-section" style="margin-bottom: var(--space-2xl);">
    <div class="card">
        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; font-size: 1.25rem; font-weight: 700;">פעילות אחרונה</h3>
            <button class="btn btn-ghost btn-sm" onclick="refreshActivity()">
                <i class="bi bi-arrow-clockwise"></i>
                רענן
            </button>
        </div>
        <div class="card-body" style="padding: 0;">
            <div class="activity-list" style="max-height: 300px; overflow-y: auto;">
                {% for entry in recent_activity %}
                <div class="activity-item" style="padding: var(--space-md) var(--space-lg); border-bottom: 1px solid rgba(0, 0, 0, 0.05); display: flex; align-items: center; gap: var(--space-md); transition: background var(--transition-fast); cursor: pointer;" onclick="handleActivityClick('{{ entry.type }}', '{{ entry.patient_name }}')">
                    <div class="activity-icon" style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
                        {% if entry.type == 'add_patient' %}background: var(--success-color);{% elif entry.type == 'update_story' %}background: var(--primary-color);{% elif entry.type == 'feedback' %}background: var(--accent-color);{% else %}background: var(--text-muted);{% endif %}">
                        {% if entry.type == 'add_patient' %}
                        <i class="bi bi-person-plus" style="color: white;"></i>
                        {% elif entry.type == 'update_story' %}
                        <i class="bi bi-journal-text" style="color: white;"></i>
                        {% elif entry.type == 'feedback' %}
                        <i class="bi bi-emoji-smile" style="color: white;"></i>
                        {% else %}
                        <i class="bi bi-info-circle" style="color: white;"></i>
                        {% endif %}
                    </div>
                    <div class="activity-content" style="flex: 1;">
                        <div class="activity-text" style="font-weight: 500; margin-bottom: var(--space-xs);">
                            {% if entry.type == 'add_patient' %}
                            נוסף מטופל חדש: <strong>{{ entry.patient_name }}</strong>
                            {% elif entry.type == 'update_story' %}
                            עודכן סיפור עבור <strong>{{ entry.patient_name }}</strong>
                            {% elif entry.type == 'feedback' %}
                            התקבל משוב חדש ממטופל <strong>{{ entry.patient_name }}</strong>
                            {% else %}
                            פעולה: {{ entry.type }} עבור <strong>{{ entry.patient_name }}</strong>
                            {% endif %}
                        </div>
                        <div class="activity-time" style="font-size: 0.875rem; color: var(--text-muted);">
                            {{ entry.timestamp }}
                        </div>
                    </div>
                    <div class="activity-action">
                        <i class="bi bi-chevron-left" style="color: var(--text-muted);"></i>
                    </div>
                </div>
                {% else %}
                <div class="empty-state" style="text-align: center; padding: var(--space-2xl); color: var(--text-muted);">
                    <i class="bi bi-clock-history" style="font-size: 3rem; margin-bottom: var(--space-md);"></i>
                    <p>אין פעילות אחרונה</p>
                    <p style="font-size: 0.9rem;">הפעילות תופיע כאן לאחר ביצוע פעולות במערכת</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize dashboard
    loadRecentPatients();
    loadUrgentCases();
    startRealTimeUpdates();
    
    // Add hover effects to activity items
    const activityItems = document.querySelectorAll('.activity-item');
    activityItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.background = 'rgba(37, 99, 235, 0.05)';
        });
        item.addEventListener('mouseleave', function() {
            this.style.background = 'transparent';
        });
    });
});

async function loadRecentPatients() {
    try {
        const response = await fetch('/api/patients');
        const data = await response.json();
        
        if (data.status === 'success') {
            const container = document.getElementById('recentPatients');
            const patients = data.patients.slice(0, 5); // Show last 5 patients
            
            if (patients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: var(--space-2xl); color: var(--text-muted);">
                        <i class="bi bi-people" style="font-size: 3rem; margin-bottom: var(--space-md);"></i>
                        <p>אין מטופלים במערכת</p>
                        <button class="btn btn-primary btn-sm" data-modal="add-patient">
                            <i class="bi bi-plus"></i>
                            הוסף מטופל ראשון
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = patients.map(patient => `
                <div class="patient-item" style="padding: var(--space-md) var(--space-lg); border-bottom: 1px solid rgba(0, 0, 0, 0.05); display: flex; align-items: center; gap: var(--space-md); transition: background var(--transition-fast); cursor: pointer;" onclick="window.location.href='/dashboard/patients/${patient.patient_id}'">
                    <div class="patient-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary-color); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                        ${(patient.first_name || patient.name || 'מ').charAt(0).toUpperCase()}
                    </div>
                    <div class="patient-info" style="flex: 1;">
                        <div class="patient-name" style="font-weight: 600; margin-bottom: var(--space-xs);">
                            ${patient.name || `${patient.first_name || ''} ${patient.last_name || ''}`.trim()}
                        </div>
                        <div class="patient-details" style="font-size: 0.85rem; color: var(--text-secondary);">
                            גיל ${patient.age || 'לא צוין'} • ${patient.gender || 'לא צוין'}
                        </div>
                    </div>
                    <div class="patient-status">
                        <span class="badge badge-success">פעיל</span>
                    </div>
                    <div class="patient-action">
                        <i class="bi bi-chevron-left" style="color: var(--text-muted);"></i>
                    </div>
                </div>
            `).join('');
        }
    } catch (error) {
        console.error('Error loading patients:', error);
        document.getElementById('recentPatients').innerHTML = `
            <div class="empty-state" style="text-align: center; padding: var(--space-2xl); color: var(--text-muted);">
                <i class="bi bi-exclamation-triangle" style="font-size: 3rem; margin-bottom: var(--space-md);"></i>
                <p>שגיאה בטעינת המטופלים</p>
            </div>
        `;
    }
}

async function loadUrgentCases() {
    try {
        // This would be expanded to check for real urgent cases
        // For now, keeping it simple
        const response = await fetch('/api/patients');
        const data = await response.json();
        
        if (data.status === 'success') {
            const highSudCount = 0; // Would calculate from actual SUD data
            const inactiveCount = 0; // Would calculate from session dates
            
            document.querySelector('.urgent-case:first-child .badge').textContent = highSudCount;
            document.querySelector('.urgent-case:last-child .badge').textContent = inactiveCount;
        }
    } catch (error) {
        console.error('Error loading urgent cases:', error);
    }
}

function handleActivityClick(type, patientName) {
    // Handle activity item clicks
    if (type === 'add_patient') {
        // Navigate to patient list to find the patient
        window.location.href = '/dashboard/patients';
    } else if (type === 'update_story') {
        // Navigate to stories
        window.location.href = '/dashboard/stories';
    } else if (type === 'feedback') {
        // Show feedback details
        if (window.dashboard) {
            window.dashboard.showNotification(`משוב מ${patientName}`, 'info');
        }
    }
}

function refreshActivity() {
    // Refresh activity feed
    const button = event.target.closest('button');
    const icon = button.querySelector('i');
    
    icon.style.animation = 'spin 1s linear infinite';
    
    // Reload the page to refresh data
    setTimeout(() => {
        window.location.reload();
    }, 1000);
}

function startRealTimeUpdates() {
    // Update dashboard every 30 seconds
    setInterval(async () => {
        await loadRecentPatients();
        await loadUrgentCases();
    }, 30000);
}

// Add CSS for enhanced interactions
const enhancedStyles = `
    .patient-item:hover, .activity-item:hover {
        background: rgba(37, 99, 235, 0.05) !important;
        transform: translateX(-2px);
    }
    
    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .card:hover {
        box-shadow: var(--shadow-xl);
        transform: translateY(-2px);
    }
    
    .stat-item:hover {
        background: rgba(37, 99, 235, 0.02);
        border-radius: var(--radius-md);
        padding: var(--space-xs);
        margin: var(--space-xs) calc(-1 * var(--space-xs));
    }
    
    @media (max-width: 768px) {
        .content-row {
            grid-template-columns: 1fr !important;
        }
        
        .metrics-row {
            grid-template-columns: 1fr !important;
        }
    }
`;

const styleSheet = document.createElement('style');
styleSheet.textContent = enhancedStyles;
document.head.appendChild(styleSheet);
</script>
{% endblock %} 